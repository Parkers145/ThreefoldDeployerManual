<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Installing and Deploying With Terraform(detailed overview)</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Threefold Deployer Manual</a></li><li class="chapter-item expanded affix "><li class="part-title">How to use the Playground to Create Deployments</li><li class="chapter-item expanded "><a href="../playground/setupthreefoldconnect.html"><strong aria-hidden="true">1.</strong> Set-up Your Playground</a></li><li class="chapter-item expanded "><a href="../playground/deploy.html"><strong aria-hidden="true">2.</strong> Deploy Your First Workload</a></li><li class="chapter-item expanded "><a href="../playground/support.html"><strong aria-hidden="true">3.</strong> Get Support</a></li><li class="chapter-item expanded affix "><li class="part-title">How To Use Your Deployments</li><li class="chapter-item expanded "><a href="../playground/setupubuntu.html"><strong aria-hidden="true">4.</strong> Setting up an Ubuntu VM</a></li><li class="chapter-item expanded "><a href="../playground/accessubuntu.html"><strong aria-hidden="true">5.</strong> Accessing Your Ubuntu VM</a></li><li class="chapter-item expanded "><a href="../flist/createfullvmflist.html"><strong aria-hidden="true">6.</strong> Create a Custom Ubuntu Full VM Image</a></li><li class="chapter-item expanded "><a href="../playground/ubuntunet.html"><strong aria-hidden="true">7.</strong> Your Cloud Ubuntu VM's Network Interfaces</a></li><li class="chapter-item expanded affix "><li class="part-title">How to use Terraform to Create Deployments</li><li class="chapter-item expanded "><a href="../terraform/setuptfcterraform.html"><strong aria-hidden="true">8.</strong> Setup Your Wallets and Accounts for Use With Terraform</a></li><li class="chapter-item expanded "><a href="../terraform/gettingstarted.html" class="active"><strong aria-hidden="true">9.</strong> Installing and Deploying With Terraform(detailed overview)</a></li><li class="chapter-item expanded "><a href="../terraform/7stepslinux.html"><strong aria-hidden="true">10.</strong> How To Deploy A Terraform Example Configuration on the Threefold Grid from Linux in 7 steps (quickstart)</a></li><li class="chapter-item expanded "><a href="../terraform/7stepswindows.html"><strong aria-hidden="true">11.</strong> Deploying an Example Configuration with Terraform on Windows Using Putty In 7 Steps (quickstart)</a></li><li class="chapter-item expanded "><a href="../terraform/singlevmmaintf.html"><strong aria-hidden="true">12.</strong> Detailed Single Full VM Main.tf Explanation</a></li><li class="chapter-item expanded "><a href="../terraform/multivmmaintf.html"><strong aria-hidden="true">13.</strong> Detailed Multi Full VM Main.tf Explanation</a></li><li class="chapter-item expanded affix "><li class="part-title">How to Install Specific Applications in a Ubuntu VM on The Threefold Grid</li><li class="chapter-item expanded "><a href="../applicationhowto/manualmastodon.html"><strong aria-hidden="true">14.</strong> Deploy Mastadon in A Full VM</a></li><li class="chapter-item expanded "><a href="../applicationhowto/manualpeertube.html"><strong aria-hidden="true">15.</strong> Deploy Peertube in A Full VM</a></li><li class="chapter-item expanded "><a href="../applicationhowto/manualfunkwhale.html"><strong aria-hidden="true">16.</strong> Deploy Funkwhale in A Full VM</a></li><li class="chapter-item expanded "><a href="../applicationhowto/manualiredmail.html"><strong aria-hidden="true">17.</strong> Host Smtp Services in A Full VM</a></li><li class="chapter-item expanded "><a href="../applicationhowto/desktopchromerdp.html"><strong aria-hidden="true">18.</strong> Linux Desktop VM with Chrome RDP</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="how-to-get-started-deploying-with-terraform"><a class="header" href="#how-to-get-started-deploying-with-terraform">How To Get Started Deploying With Terraform</a></h1>
<h1 id="what-is-terraform"><a class="header" href="#what-is-terraform">What Is Terraform</a></h1>
<p>Terraform is an open-source infrastructure as code software tool created by HashiCorp. It allows users to define and provision infrastructure resources (e.g. virtual machines, network switches, containers) using a high-level configuration language called HashiCorp Configuration Language (HCL).</p>
<p>With Terraform, users can define the desired infrastructure resources and their dependencies in a configuration file, and use the terraform apply command to provision and manage those resources. Terraform supports a wide range of cloud providers, including AWS, Azure, Google Cloud, and many others, as well as on-premises and other infrastructure.</p>
<p>One of the main benefits of using Terraform is that it allows users to automate the process of provisioning and managing infrastructure resources. This can save time and reduce the risk of errors compared to manually creating and managing resources through a web console or API.</p>
<p>Terraform also includes features such as version control, resource dependencies, and the ability to preview and apply changes, which can help users manage their infrastructure more effectively.</p>
<h1 id="how-do-i-use-it"><a class="header" href="#how-do-i-use-it">How do I use it</a></h1>
<details>
    <summary><b>Installing Terraform:</b></summary>
<ul>
<li>Go to the Terraform downloads page (https://www.terraform.io/downloads.html).</li>
<li>Select the appropriate installer for your operating system (e.g. Windows, Linux, macOS).</li>
<li>Run the installer and follow the prompts to install Terraform.</li>
<li>Open a terminal or command prompt window.</li>
<li>Type 
<pre><code>terraform
</code></pre>
and press Enter to verify that the installation was successful. You should see the Terraform usage information displayed.</li>
</ul>
</details>
<details>
    <summary><b>Ubuntu Install </b></summary> 
<p>To install Terraform on Ubuntu using apt, follow these steps:</p>
<p>Add the HashiCorp package signing key to your system's keyring by running the following command:</p>
<pre><code>curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
</code></pre>
<p>Add the HashiCorp APT repository to your system's package manager by running the following command:</p>
<pre><code>sudo apt-add-repository &quot;deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main&quot;
</code></pre>
<p>Update your system's package list by running the following command:</p>
<pre><code>sudo apt update
</code></pre>
<p>Install Terraform by running the following command:</p>
<pre><code>sudo apt install terraform
</code></pre>
<p>Verify that the installation was successful by running the following command:</p>
<pre><code>terraform --version
</code></pre>
<p>You should see the version of Terraform that you installed displayed.</p>
<p>Now you are ready to use Terraform to deploy the main.tf configuration file. Follow the steps in the previous tutorial to deploy the configuration.</p>
</details>
<details>
    <summary><b>Windows Install Instructions</b></summary> 
<p>To install Terraform on Windows, follow these steps:</p>
<ul>
<li>Go to the Terraform downloads page (https://www.terraform.io/downloads.html).</li>
<li>Select the &quot;Windows 64-bit&quot; package and download it to your system.</li>
<li>Double-click the downloaded .exe file to start the installation process.</li>
<li>Follow the prompts to install Terraform.</li>
<li>Once the installation is complete, open a command prompt window.</li>
<li>Type terraform and press Enter to verify that the installation was successful. You should see the Terraform usage information displayed.</li>
<li>Now you are ready to use Terraform to deploy the main.tf configuration file. Follow the steps in the previous tutorial to deploy the configuration.</li>
</ul>
</details>
<details>
    <summary><b>Setting your Enviroment variables</b></summary> 
<p>Next, you would need to create a file called env.tfvars in the /deployments directory, which should contain the values for the variables defined in main.tf. For example:</p>
<pre><code>MNEMONICS = &quot;abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon&quot;
NETWORK = &quot;main&quot;
SSH_KEY = &quot; Your SSH KEY here&quot;
</code></pre>
<p>You can use multiple .tfvars files to save different configurations in the /deployments directory. To use a specific .tfvars file when running the terraform apply command, you can specify the path to the file using the -var-file flag.</p>
<p>For example, if you have three .tfvars files in the /deployments directory:</p>
<p>prod.tfvars
stage.tfvars
dev.tfvars
You can use the following commands to apply the configuration using the different .tfvars files:</p>
<pre><code>terraform apply -parallelism=1 -auto-approve -var-file=&quot;/deployments/prod.tfvars&quot;
</code></pre>
<p>This command will apply the configuration using the values specified in the prod.tfvars file.</p>
<pre><code>terraform apply -parallelism=1 -auto-approve -var-file=&quot;/deployments/stage.tfvars&quot;
</code></pre>
<p>This command will apply the configuration using the values specified in the stage.tfvars file.</p>
<pre><code>terraform apply -parallelism=1 -auto-approve -var-file=&quot;/deployments/dev.tfvars&quot;
</code></pre>
<p>This command will apply the configuration using the values specified in the dev.tfvars file.</p>
<p>This way, you can use different .tfvars files to save different configurations and easily switch between them by specifying the path to the desired file when running the terraform apply command.</p>
</details>
<details>
    <summary><b>Deploying A Configuration on Linux:</b></summary>
<ul>
<li>Create a new directory where you want to store your Terraform configuration.</li>
</ul>
<pre><code>mkdir /deployments
mkdir /deployments/testdeployment
</code></pre>
<ul>
<li>copy the main.tf file and write it to the directory you just created.</li>
</ul>
<pre><code>nano main.tf
# paste the contents of the main tf then press Ctrl+X, and confirm 
</code></pre>
<details>
        <summary><b>If the example you are deploying does not use `variable blocks` (i.e. most not created by me)  you will have to add them</b></summary>
<pre><code>     ```
     # ADD THE THREE VARIABLES ABOVE THE EXSITING LINES IN THE main.tf your are deploying 
     variable &quot;MNEMONICS&quot; {
     type        = string
     description = &quot;The mnemonic phrase used to generate the seed for the node.&quot;
      }

     variable &quot;NETWORK&quot; {
     type        = string
     default     = &quot;main&quot;
     description = &quot;The network to connect the node to.&quot;
     }

     variable &quot;SSH_KEY&quot; {
     type = string
     }




      # CHANGE THESE SECTIONS OF THE main.tf to use the variables 

      provider &quot;grid&quot; {
      mnemonics = &quot;${var.MNEMONICS}&quot;
      network   = &quot;${var.NETWORK}&quot;  
       }
      and 
      env_vars = { 
                  SSH_KEY = &quot;${var.SSH_KEY}&quot; 
      } variable &quot;MNEMONICS&quot; {


     } 
     ```
</code></pre>
</details>
<ul>
<li>Open a terminal or command prompt window and navigate to the directory where you placed the main.tf file.</li>
</ul>
<pre><code>cd /deployments/testdeployment
</code></pre>
<ul>
<li>Run the following command to initialize the directory as a Terraform configuration directory and install the required provider(s):</li>
</ul>
<pre><code>terraform init
</code></pre>
<ul>
<li>Run the following command to apply the changes specified in the configuration and create the resources defined in main.tf:</li>
</ul>
<pre><code>terraform apply -parallelism=1 -auto-approve -var-file=&quot;/deployments/prod.tfvars&quot;
</code></pre>
<p>Wait for the command to complete</p>
</details>
<details>
    <summary><b>Deploying A Configuration on Windows</b></summary> 
<p>To create and use Terraform to deploy a configuration file on Windows, follow these steps:</p>
<ul>
<li>Create a new directory where you want to store your Terraform configuration. For example:</li>
</ul>
<pre><code>mkdir C:\deployments
mkdir C:\deployments\testdeployment
</code></pre>
<ul>
<li>
<p>Open a text editor and create a new file called main.tf.</p>
</li>
<li>
<p>Add the example main.tf below and save the file as main.tf </p>
<details>
      <summary><b>If the example you are deploying does not use `variable blocks` (i.e. most not created by me)  you will have to add them</b></summary>
<pre><code>   ```
   # ADD THE THREE VARIABLES ABOVE THE EXSITING LINES IN THE main.tf your are deploying 
   variable &quot;MNEMONICS&quot; {
   type        = string
   description = &quot;The mnemonic phrase used to generate the seed for the node.&quot;
    }

   variable &quot;NETWORK&quot; {
   type        = string
   default     = &quot;main&quot;
   description = &quot;The network to connect the node to.&quot;
   }

   variable &quot;SSH_KEY&quot; {
   type = string
   }




    # CHANGE THESE SECTIONS OF THE main.tf to use the variables 

    provider &quot;grid&quot; {
    mnemonics = &quot;${var.MNEMONICS}&quot;
    network   = &quot;${var.NETWORK}&quot;  
     }
    and 
    env_vars = { 
                SSH_KEY = &quot;${var.SSH_KEY}&quot; 
    } variable &quot;MNEMONICS&quot; {


   } 
   ```
</code></pre>
</details>
</li>
<li>
<p>Open a command prompt window and navigate to the testdeployment directory. For example:</p>
</li>
</ul>
<pre><code>cd C:\deployments\testdeployment
</code></pre>
<ul>
<li>Run the following command to initialize the directory as a Terraform configuration directory and install the required provider(s):</li>
</ul>
<pre><code>terraform init
</code></pre>
<ul>
<li>
<p>Create a file called env.tfvars in the same directory as the main.tf file, and add the values for the variables defined in main.tf.</p>
</li>
<li>
<p>Run the following command to apply the changes specified in the configuration and create the resources defined in main.tf:</p>
</li>
</ul>
<pre><code>terraform apply -parallelism=1 -auto-approve -var-file=&quot;C:\\deployments:\yourfile.tfvars&quot;
</code></pre>
<p>Wait for the command to complete.</p>
</details>
<h1 id="resources"><a class="header" href="#resources">Resources</a></h1>
<details>
    <summary><b>Example Main.tf</b></summary>
<pre><code>variable &quot;MNEMONICS&quot; {
  type        = string
  description = &quot;The mnemonic phrase used to generate the seed for the node.&quot;
}

variable &quot;NETWORK&quot; {
  type        = string
  default     = &quot;main&quot;
  description = &quot;The network to connect the node to.&quot;
}

variable &quot;SSH_KEY&quot; {
  type = string
}


terraform {
  required_providers {
    grid = {
      source = &quot;threefoldtech/grid&quot;
    }
  }
}

provider &quot;grid&quot; {
    mnemonics = &quot;${var.MNEMONICS}&quot;
    network = &quot;${var.NETWORK}&quot;  
}

resource &quot;grid_network&quot; &quot;net1&quot; {
    nodes = [311, 312]
    ip_range = &quot;10.32.0.0/16&quot;
    name = &quot;internal&quot;
    description = &quot;Internal subnet&quot;
    add_wg_access = true
}
resource &quot;grid_deployment&quot; &quot;d1&quot; {
  node = 311
  network_name = grid_network.net1.name
  disks {
    name = &quot;data&quot;
    size = 25
  }
    vms {
    name = &quot;vm1&quot;
    description =&quot;Test vm 1&quot;
    flist = &quot;https://hub.grid.tf/tf-official-vms/ubuntu-22.04-lts.flist&quot;
    cpu = 4
    publicip = true
    publicip6 = true
    memory = 8192
    mounts {
        disk_name = &quot;data&quot;
        mount_point = &quot;/data&quot;
    }
    planetary = true
    env_vars = {
      SSH_KEY = &quot;${var.SSH_KEY}&quot;
    }
  }
}
resource &quot;grid_deployment&quot; &quot;d2&quot; {
  node = 312
  network_name = grid_network.net1.name
  disks {
    name = &quot;data&quot;
    size = 25
  }
    vms {
    name = &quot;vm2&quot;
    description =&quot;Test vm 2&quot;
    flist = &quot;https://hub.grid.tf/tf-official-vms/ubuntu-22.04-lts.flist&quot;
    cpu = 4
    publicip = true
    publicip6 = true
    memory = 8192
    mounts {
        disk_name = &quot;data&quot;
        mount_point = &quot;/data&quot;
    }
    planetary = true
    env_vars = {
      SSH_KEY = &quot;${var.SSH_KEY}&quot;
    }
  }
}
output &quot;wg_config&quot; {
value = grid_network.net1.access_wg_config
}
output &quot;node1_vm1_ip&quot; {
value = grid_deployment.d1.vms[0].ip
}
output &quot;public_ip&quot; {
value = grid_deployment.d1.vms[0].computedip
}
output &quot;public_ip6&quot; {
value = grid_deployment.d1.vms[0].computedip6
}
output &quot;ygg_ip&quot; {
value = grid_deployment.d1.vms[0].ygg_ip
}
</code></pre>
</details>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../terraform/setuptfcterraform.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../terraform/7stepslinux.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../terraform/setuptfcterraform.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../terraform/7stepslinux.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
